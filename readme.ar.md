# Nashir
[[English]](readme.md)

<div dir=rtl>

مكتبة لتسهيل بناء ونشر المشاريع. تعتمد هذه المكتبة تصيميما يتيح إضافة مشغلات لخدمات الاستضافة المختلفة.
يتوفر حاليا مشغلان، أحدهما مخصص لخدمة الأسس نت، بينما الآخر عام يعتمد على بروتوكول SSH لنشر المشاريع.

## الاستخدام

تفترض هذه الخطوات أن لديك بالفعل مشروعًا يستخدم مـنصة_ويب وتريد نشره.

* أضف المكتبة إلى مشروعك، مع تحميل المشغل المطلوب:

```
اشمل "مـحا"؛
مـحا.اشمل_ملف("Alusus/Nashir"، { "نـاشر.أسس"، "مـشغلات/الـأسس_نت.أسس" })؛
```

<div dir=ltr>

```
import "Apm";
Apm.importFile("Alusus/Nashir", { "Nashir.alusus", "Drivers/AlususNet.alusus" });
```

</div>

أو لتحميل مشغل SSH:

```
اشمل "مـحا"؛
مـحا.اشمل_ملف("Alusus/Nashir"، { "نـاشر.أسس"، "مـشغلات/بـروتوكول_النقل_الآمن.أسس" })؛
```

<div dir=ltr>

```
import "Apm";
Apm.importFile("Alusus/Nashir", { "Nashir.alusus", "Drivers/Ssh.alusus" });
```

</div>

* انشئ دالة رئيسية لبدء الخادم. احرص على تشغيل الخادم على المنفذ 8000 واحرص ايضًا على الانتظار
  اللانهائي بعد تشغيل الخادم كي لا يخرج البرنامج مباشرة.

```
دالة ابدأ_الخادم {
    طـرفية.اطبع("تشغيل الخادم على المنفذ 8000...\ج")؛
    ابدأ_الخادم({ "listening_ports"، "8010"، "static_file_max_age"، "0" })؛
    طـرفية.اطبع("الخادم جاهز\ج")؛
    بينما 1 نـظام.نم(1000000)؛
}
```

<div dir=ltr>

```
func startServer {
    Console.print("Starting server on port 8000...\n");
    startServer({ "listening_ports", "8000", "static_file_max_age", "0" });
    Console.print("Server is running.\n");
    while 1 System.sleep(1000000);
}
```

</div>

* هيئ مكتبة الناشر في نهاية برنامجك. يمكنك تحديد قيمة إطناب بـ1 للحصول على معلومات مفصلة أكثر أثناء
  نشر المشروع. معطى الماكرو `هيئ` هو عبارة تهيشة المشغل المستخدم لنشر المشروع. قد تتطلب تهيئة المشغل
  معطيات خاصة بذلك المشغل. على سبيل المثال، لتهئية المشغل الخاص بخدمة الأسس نت تمرر معطيين، الأول
  هو اسم المشروع، بينما المعطى الثاني هو المنفذ الذي يستخدمه الخادم. اسم المشروع يستخدم لتحديد
  اسم المشروع على الأسس نت عند النشر.

```
نـاشر.إطناب = 0؛
نـاشر.هيئ[نـاشر.مـشغل_الأسس_نت(نـص("&lt;اسم_المشروع&gt;")، 8000)]؛
```

<div dir=ltr>

```
Nashir.verbose = false;
Nashir.initialize[Nashir.AlususNetDriver(String("&lt;ProjectName&gt;"), 8000)];
```

</div>

* حدد قائمة الاعتماديات والموارد.


```
نـاشر.الموارد.أضف({ نـص("موارد") })؛
نـاشر.الاعتماديات.أضف(مـنصة_ويب.هات_اعتماديات_البناء())؛
```

<div dir=ltr>

```
Nashir.assets.add({ String("Assets") });
Nashir.dependencies.add(WebPlatform.getBuildDependencies());
```

</div>

* استدع ماكرو التشغيل مع إعطائه اسم دالة تشغيل الخادم.

```
نـاشر.ابدأ[ابدأ_الخادم]؛
```

<div dir=ltr>

```
Nashir.startup[startServer];
```

</div>

* بعد إتمام هذه الخطوات سيمكنك تشغيل التطبيق مباشرة كما يلي:

```
الأسس بداية.أسس
```

<div dir=ltr>

```
alusus main.alusus
```

</div>

ويمكنك أيضًا بناء نسخة تنفيذية من المشروع:

```
الأسس بداية.أسس ابن
```

<div dir=ltr>

```
alusus main.alusus build
```

</div>

ويمكنك أيضًا نشر المشروع إلى "الأسس نت":

```
الأسس بداية.أسس انشر
```

<div dir=ltr>

```
alusus main.alusus publish
```

</div>

عند استدعاء أمر النشر ستبني المكتبة نسخة تنفيذية من المشروع ثم تطلب منك تسجيل الدخول بحساب "الأسس نت"
ثم تحمل المشروع إلى الخادم وتشغله تلقائيًا. اتبع التعيلمات التي ستظهر لك لإكمال النشر.


## المرجع

### أنشئ_مدخل_تنفيذ (createStartExe)

ماكرو مساعد لإنشاء دالة مدخل البرنامج التنفيذي. تحدد هذه الدالة مسارات الموارد قبل استدعاء الدالة
الرئيسية. يستقبل هذا الماكرو معطيين:
* الاسم: اسم الدالة التي سيتم إنشاؤها.
* بداية: اسم الدالة التي ستستدعى بعد تحديد المسارات، وهي الدالة التي تشغل الخادم. عادة تكون هذه
  الدالة هي الدالة التي تُستدعى عند تشغيل المشروع بصيغة JIT.

### ابن (build)

دالة لبناء المشروع. تُنشئ هذه الدالة ملفا تنفيذيا للمشروع وتنسخ الموارد المطلوبة إلى مجلد البناء.
تُستدعى هذه الدالة من الماكرو `ابدأ`.

```
دالة ابن [بداية: سند_شبم] (موارد: مـصفوفة[نـص]، اعتماديات: مـصفوفة[نـص])
```

<div dir=ltr>

```
func build [start: ast_ref] (assets: Array[String], deps: Array[String])
```

</div>

المعطيات:
* `بداية` (`start`): معطى قالب يشير إلى دالة مدخل البرنامج التنفيذي.
* `موارد` (`assets`): قائمة ملفات ومجلدات الموارد. يجب أن تحتوي هذه المصوفة على مسارات نسبية (نسبة
  إلى المجلد الحالي)، وستنسخ إلى المجلد `Build` بنفس المسارات النسبية.
* `اعتماديات` (`deps`): قائمة المكتبات الديناميكية التي يعتمد عليها المشروع.

### انشر (publish)

دالة لنشر المشروع باستخدام المشغل المحدد عند التهيئة. يجب بناء المشروع باستخدام دالة `ابن` قبل استدعاء هذه الدالة.
هذه الدالة تُستدعى من قبل الماكرو `ابدأ`.

### المشغلات

#### مـشغل_الأسس_نت (AlususNetDriver)

لنشر التطبيق على خدمة الأسس نت. لتهيئة المشغل:

```
مـشغل_الأسس_نت(اسم_المشروع: نـص، المنفذ: صـحيح)؛
```

<div dir=ltr>

```
AlususNetDriver(projectName: String, servicePort: Int);
```

</div>

المعطى الأول هو اسم المشروع على خدمة الأسس نت.

المعطى الثاني هو المنفذ الذي يستخدمه المشروع عند تشغيل الخادم.

### مـشغل_بروتوكول_النقل_الآمن (SshDriver)

لنشر التطبيق عبر بروتوكل SSH إلى أي خادم أو خدمة تدعم هذا البروتوكول. لتهئية المشغل:

```
مـشغل_بروتوكول_النقل_الآمن()؛
مـشغل_بروتوكول_النقل_الآمن(
    اسم_المستخدم: نـص،
    عنوان_الخادم: نـص،
    المنفذ: صـحيح،
    المسار_على_الخادم: نـص،
    اسم_الخدمة: نـص
)؛
```

<div dir=ltr>

```
SshDriver();
SshDriver(
    username: String,
    host: String,
    port: Int,
    serverPath: String,
    serviceName: String
);
```

</div>

الصيغة الأولى تجعل المشغل يسأل المستخدم أثناء النشر عن المعلومات المطلوبة للنشر، بينما الصيغة
الثانية توفر له المعلومات برمجيا.

المعطيات الثلاثة الأولى هي البيانات المطلوبة للاتصال باستخدام
بروتوكل SSH، بينما المعطى الرابع هو المسار على الخادم الذي ستنسخ له ملفات المشروع.

المعطى الخامس اختياري، ويحدد اسم خدمة systemd التي تشغل المشروع. عند توفير اسم الخدمة سيُعاد
تشغيلها تلقائيا بعد النشر.

</div>

