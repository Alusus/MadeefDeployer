# Nashir
[[English]](readme.md)

مكتبة لتمكين بناء ونشر تطبيقات الويب على خدمة استضافة "الأسس نت".

## الاستخدام

تفترض هذه الخطوات أن لديك بالفعل مشروعًا يستخدم مـنصة_ويب وتريد نشره.

* أضف المكتبة إلى مشروعك:

<div dir=rtl>

```
اشمل "مـحا"؛
مـحا.اشمل_ملف("Alusus/Nashir"، "نـاشر.أسس")؛
```

</div>

```
import "Apm";
Apm.importFile("Alusus/Nashir");
```

* انشئ دالة رئيسية لبدء الخادم. احرص على تشغيل الخادم على المنفذ 8000 واحرص ايضًا على الانتظار
  اللانهائي بعد تشغيل الخادم كي لا يخرج البرنامج مباشرة.

<div dir=rtl>

```
دالة ابدأ_الخادم {
    طـرفية.اطبع("تشغيل الخادم على المنفذ 8000...\ج")؛
    ابدأ_الخادم({ "listening_ports"، "8010"، "static_file_max_age"، "0" })؛
    طـرفية.اطبع("الخادم جاهز\ج")؛
    بينما 1 نـظام.نم(1000000)؛
}
```

</div>

```
func startServer {
    Console.print("Starting server on port 8000...\n");
    startServer({ "listening_ports", "8000", "static_file_max_age", "0" });
    Console.print("Server is running.\n");
    while 1 System.sleep(1000000);
}
```

* هيئ مكتبة الناشر في نهاية برنامجك. يمكنك تحديد قيمة إطناب بـ1 للحصول على معلومات مفصلة أكثر أثناء
  نشر المشروع. المعطى الأول للماكرو `هيئ` هو اسم المشروع، بينما المعطى الثاني هو المنفذ الذي يستخدمه
  الخادم. اسم المشروع يستخدم لتحديد اسم المشروع على الأسس نت عند النشر.

<div dir=rtl>

```
نـاشر.إطناب = 0؛
نـاشر.هيئ["<اسم_المشروع>"، 8000]؛
```

</div>

```
Nashir.verbose = false;
Nashir.initialize["<ProjectName>", 8000];
```

* حدد قائمة الاعتماديات والموارد.

<div dir=rtl>

```
نـاشر.الموارد.أضف({ نـص("موارد") })؛
نـاشر.الاعتماديات.أضف(مـنصة_ويب.هات_اعتماديات_البناء())؛
```

</div>

```
Nashir.assets.add({ String("Assets") });
Nashir.dependencies.add(WebPlatform.getBuildDependencies());
```

* استدع ماكرو التشغيل مع إعطائه اسم دالة تشغيل الخادم.

<div dir=rtl>

```
نـاشر.ابدأ[ابدأ_الخادم]؛
```

</div>

```
Nashir.startup[startServer];
```

* بعد إتمام هذه الخطوات سيمكنك تشغيل التطبيق مباشرة كما يلي:

<div dir=rtl>

```
الأسس بداية.أسس
```

</div>

```
alusus main.alusus
```

ويمكنك أيضًا بناء نسخة تنفيذية من المشروع:

<div dir=rtl>

```
الأسس بداية.أسس ابن
```

</div>

```
alusus main.alusus build
```

ويمكنك أيضًا نشر المشروع إلى "الأسس نت":

<div dir=rtl>

```
الأسس بداية.أسس انشر
```

</div>

```
alusus main.alusus publish
```

عند استدعاء أمر النشر ستبني المكتبة نسخة تنفيذية من المشروع ثم تطلب منك تسجيل الدخول بحساب "الأسس نت"
ثم تحمل المشروع إلى الخادم وتشغله تلقائيًا. اتبع التعيلمات التي ستظهر لك لإكمال النشر.


## المرجع

### أنشئ_مدخل_تنفيذ (createStartExe)

ماكرو مساعد لإنشاء دالة مدخل البرنامج التنفيذي. تحدد هذه الدالة مسارات الموارد قبل استدعاء الدالة
الرئيسية. يستقبل هذا الماكرو معطيين:
* الاسم: اسم الدالة التي سيتم إنشاؤها.
* بداية: اسم الدالة التي ستستدعى بعد تحديد المسارات، وهي الدالة التي تشغل الخادم. عادة تكون هذه
  الدالة هي الدالة التي تُستدعى عند تشغيل المشروع بصيغة JIT.

### ابن (build)

دالة لبناء المشروع. تُنشئ هذه الدالة ملفا تنفيذيا للمشروع وتنسخ الموارد المطلوبة إلى مجلد البناء.
تُستدعى هذه الدالة من الماكرو `ابدأ`.

<div dir=rtl>

```
دالة ابن [بداية: سند_شبم] (موارد: مـصفوفة[نـص]، اعتماديات: مـصفوفة[نـص])
```

</div>

```
func build [start: ast_ref] (assets: Array[String], deps: Array[String])
```

المعطيات:
* `بداية` (`start`): معطى قالب يشير إلى دالة مدخل البرنامج التنفيذي.
* `موارد` (`assets`): قائمة ملفات ومجلدات الموارد. يجب أن تحتوي هذه المصوفة على مسارات نسبية (نسبة
  إلى المجلد الحالي)، وستنسخ إلى المجلد `Build` بنفس المسارات النسبية.
* `اعتماديات` (`deps`): قائمة المكتبات الديناميكية التي يعتمد عليها المشروع.

### انشر (publish)

دالة لنشر المشروع إلى خدمة الأسس نت. يجب بناء المشروع باستخدام دالة `ابن` قبل استدعاء هذه الدالة.
هذه الدالة تُستدعى من قبل الماكرو `ابدأ`.

